function onLoadInit(){searchKeyword.value="",searchKeyword.style.borderColor="#ddd",searchBtn.setAttribute("disabled","disabled"),searchBtn.classList.add("btn-disabled")}function searchBoxAction(e){null!=e.target.value&&""!=e.target.value?(searchKeyword.style.borderColor="#ddd",searchBtn.removeAttribute("disabled"),searchBtn.classList.remove("btn-disabled")):(searchBtn.setAttribute("disabled","disabled"),searchBtn.classList.add("btn-disabled"))}async function searchBookmarks(){let e=searchKeyword.value.trim();null!=e&&""!=e?(result.innerHTML=initLoading(),await getSearchBookmarks(e).then(e=>{infoText.innerHTML="Getting your search bookmarks....",loadBookmarks(e,"search")}).catch(e=>{loadErrors(e)})):(searchKeyword.focus(),searchKeyword.style.borderColor="red")}async function recentBookmarks(){result.innerHTML=initLoading(),onLoadInit(),await getRecentBookmarks().then(e=>{infoText.innerHTML="Getting your recent bookmarks....",loadBookmarks(e,"recent")}).catch(e=>{loadErrors(e)})}async function allBookmarks(){result.innerHTML=initLoading(),onLoadInit(),await getAllBookmarks().then(e=>{infoText.innerHTML="Getting your all bookmarks....",loadBookmarks(e,"all")}).catch(e=>{loadErrors(e)})}function fetchBookmarks(e){e.forEach(function(e){void 0!==e.url&&null!==e.url&&bookmarObject.push({title:e.title,url:e.url,createdAt:formatDate(e.dateAdded)}),e.children&&fetchBookmarks(e.children)})}function getAllBookmarks(){return new Promise((e,t)=>{try{bookmarObject=new Array,chrome.bookmarks.getTree(function(t){fetchBookmarks(t),e(JSON.stringify(bookmarObject))})}catch(e){t("Something Went Wrong!! Please Try Again...")}})}function getRecentBookmarks(){return new Promise((e,t)=>{try{let n=new Array;chrome.bookmarks.getRecent(100,t=>{t.forEach(function(e){void 0!==e.url&&null!==e.url&&n.push({title:e.title,url:e.url,createdAt:formatDate(e.dateAdded)})}),e(JSON.stringify(n))})}catch(e){t("Something Went Wrong!! Please Try Again...")}})}function getSearchBookmarks(e){return new Promise((t,n)=>{try{let r=new Array;chrome.bookmarks.search(e,e=>{e.forEach(function(e){void 0!==e.url&&null!==e.url&&r.push({title:e.title,url:e.url,createdAt:formatDate(e.dateAdded)})}),t(JSON.stringify(r))})}catch(e){n("Something Went Wrong!! Please Try Again...")}})}function formatDate(e){return new Date(e).toISOString().slice(0,10).replace(/-/g,"/")}function loadBookmarks(e,t=null){result.innerHTML=initLoading(),e&&setTimeout(()=>{let n=JSON.parse(e);if("search"==t&&(n=n.reverse()),n.length&&Object.keys(n)){let e="";n.map((t,n)=>{e+=`<tr class="bookmark-row" id="bookmarkRow${n}">\n                        <td>\n                            <span class="bookmark-title">${t.title}</span><br/>\n                            <a href="${t.url}" class="bookmark-link" target="_blank">${t.url}</a>\n                        </td>\n                        <td><span class="bookmark-date">${t.createdAt}</span></td>\n                    </tr>`}),result.innerHTML=e,infoText.innerHTML="","recent"==t&&(infoText.innerHTML=`Recent ${n.length} Bookmarks`),"all"==t&&(infoText.innerHTML=`Your all Bookmarks - ${n.length}`),"search"==t&&(infoText.innerHTML=`Found - ${n.length} Bookmarks`)}else noRecordsFound(),infoText.innerHTML=`Found - ${n.length} Bookmarks`},3e3)}function loadErrors(e){result.innerHTML=initLoading(),e&&setTimeout(()=>{result.innerHTML=`<tr><td colspan="2"><span class="error-msg">${e}</span></td></tr>`},2e3)}function noRecordsFound(){result.innerHTML='<tr><td colspan="2">Oops! I\'m very Sorry, No Bookmarks Found.</td></tr>'}async function downloadAsCsv(e){e.preventDefault(),infoText.innerHTML="Start downloading...",await getAllBookmarks().then(e=>{createCsv(e)}).catch(e=>{loadErrors(e)})}function createCsv(e){const t=JSON.parse(e);if(t.length){const e=Object.keys(t[0]).toString(),n=t.map(e=>Object.values(e).toString()),r=[e,...n].join("\n");startCsvDownload(r,t.length)}}function startCsvDownload(e,t=0){const n=new Blob([e],{type:"application/csv"}),r=URL.createObjectURL(n),o=document.createElement("a");o.download="onex-bookmark-export-"+Date.now()+".csv",o.href=r,o.style.display="none",document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(r),infoText.innerHTML=`${t} - Bookmarks exported as CSV`}function displayPlaceholder(){return'<div class="ph-item">\n        <div class="ph-col-12">\n            <div class="ph-row">\n                <div class="ph-col-6"></div>\n                <div class="ph-col-6 empty"></div>\n                <div class="ph-col-4"></div>\n                <div class="ph-col-8 empty"></div>\n                <div class="ph-col-6"></div>\n                <div class="ph-col-6 empty"></div>\n                <div class="ph-col-12"></div>\n            </div>\n        </div>\n    </div>'}function initLoading(){return`<tr><td colspan="2">${displayPlaceholder()}</td></tr>\n        <tr><td colspan="2">${displayPlaceholder()}</td></tr>`}const allBtn=document.querySelector("#allBtn"),searchBtn=document.querySelector("#searchBtn"),recentBtn=document.querySelector("#recentBtn"),result=document.querySelector("#result"),downloadBtn=document.querySelector("#downloadBookmarkCsv"),searchKeyword=document.querySelector("#searchTxtb"),infoText=document.querySelector("#infoHolder");var bookmarObject=new Array;recentBtn.addEventListener("click",recentBookmarks),allBtn.addEventListener("click",allBookmarks),searchBtn.addEventListener("click",searchBookmarks),searchKeyword.addEventListener("keyup",searchBoxAction),downloadBtn.addEventListener("click",downloadAsCsv),window.addEventListener("DOMContentLoaded",async()=>{result.innerHTML=initLoading(),onLoadInit(),recentBookmarks()});